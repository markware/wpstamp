/*! tshirtEditor 2016-02-12 */
function clearOther(){var a=$(".freedraw");drawline=!1,$(".line-draw").hide(),$(".line").removeClass("active"),canvas.isDrawingMode&&(a.removeClass("active"),canvas.isDrawingMode=!1)}function flip(c,d,e,f){var f="undefined"==typeof f?"false":f;if(1==hasback)if("back"==$("#flip").attr("data-original")){$("#flip").attr("data-original","front"),a=JSON.stringify(e),0==f&&$("#tshirtFacing").addClass("flip"),e.clear(),e.renderAll();try{{JSON.parse(b)}e.loadFromJSON(b),e.renderAll()}catch(g){}e.renderAll(),setTimeout(function(){e.calcOffset(),e.renderAll()},200)}else{0==f&&$("#tshirtFacing").removeClass("flip"),$("#flip").attr("data-original","back"),b=JSON.stringify(e),e.clear(),e.renderAll();try{{JSON.parse(a)}e.loadFromJSON(a),e.renderAll()}catch(g){}e.renderAll(),setTimeout(function(){e.calcOffset(),e.renderAll()},200)}else{$("#flip").attr("data-original","front"),a=JSON.stringify(e),0==f&&$("#tshirtFacing").addClass("flip"),e.clear(),e.renderAll();try{{JSON.parse(b)}e.loadFromJSON(b),e.renderAll()}catch(g){}e.renderAll(),setTimeout(function(){e.calcOffset(),e.renderAll()},200)}}function initCustomization(){fabric.Object.prototype.transparentCorners=!1,fabric.Object.prototype.opacity=1,fabric.Object.prototype.cornerColor=fa_settings.setting_corner_color_,fabric.Object.prototype.borderColor=fa_settings.setting_border_color_,fabric.Object.prototype.hasRotatingPoint=!1,fabric.Object.prototype.cornerSize=fa_settings.setting_corner_width_,/(iPhone|iPod|iPad)/i.test(navigator.userAgent)&&(fabric.Object.prototype.cornerSize=fa_settings.setting_corner_width_+30)}function hideProgressBar(){$("#tshirtFacing .progress-bar").removeClass("active")}function showProgressBar(){$("#tshirtFacing .progress-bar").addClass("active")}function addLibrary(a,b){var c=$(".photo.uploaded .photo-list");c.parent().find("em").remove(),c.append('<li><img data-full="'+a+'" data-id="'+b+'" src="'+a+'" /></li>')}function handleFiles(a,b){if(1==b){var c=a.name,d=new FileReader;showProgressBar(),d.onload=function(a){var b=new Image;b.src=a.target.result,b.onload=function(){var a=b.src,d=(a.replace(/^.*[\\\/]/,""),$("#").data("Id"));jQuery.ajax({type:"POST",dataType:"json",async:!0,url:fa_settings.site_url_+"/wp-admin/admin-ajax.php",data:{base:this.src,filename:c,id:d,action:"up_app_product"},success:function(a){1==a.success&&(addLibrary(a.url,a.id),addImage(a.url))},error:function(){},complete:function(){hideProgressBar()}})}},d.readAsDataURL(a)}else for(var e,f=a.target.files,g=0;e=f[g];g++){var c=e.name,d=new FileReader;showProgressBar(),d.onload=function(a){var b=new Image;b.src=a.target.result,b.onload=function(){var a=b.src,d=(a.replace(/^.*[\\\/]/,""),$("#").data("Id"));jQuery.ajax({type:"POST",dataType:"json",async:!0,url:fa_settings.site_url_+"/wp-admin/admin-ajax.php",data:{base:this.src,filename:c,id:d,action:"up_app_product"},success:function(a){1==a.success&&(addLibrary(a.url,a.id),addImage(a.url))},error:function(){},complete:function(){hideProgressBar()}})}},d.readAsDataURL(a.target.files[g])}}function moveLine(a){if(1==drawline){if(!isDown)return;var b=canvas.getPointer(a.e);line.set({x2:b.x,y2:b.y}),line.setCoords(),canvas.calcOffset().renderAll()}}function startLine(a){if(1==drawline){canvas.selection=!1,isDown=!0;var b=canvas.getPointer(a.e),c=[b.x,b.y,b.x,b.y];line=new fabric.Line(c,{strokeWidth:$("#drawing-line-width").slider("option","value"),fill:$("#main-color").minicolors("value"),stroke:$("#main-color").minicolors("value"),originX:"center",originY:"center"}),canvas.add(line),line.setCoords(),canvas.calcOffset().renderAll()}}function getRandomNum(a,b){return Math.random()*(b-a)+a}function onMouseUp(){(lineW||lineH)&&(canvas.remove(lineW),canvas.remove(lineH)),lineAdded=!1,isDown=!1,canvas.selection=!0,canvas.renderAll()}function onObjectMoving(){if(0==lineAdded){var a=canvas.width/2,b=canvas.height/2;lineW=new fabric.Line([a,0,a,canvas.height],{stroke:"magenta",strokeWidth:1,selectable:!1}),lineH=new fabric.Line([0,b,canvas.width,b],{stroke:"magenta",strokeWidth:1,selectable:!1}),canvas.add(lineW),canvas.add(lineH),canvas.calcOffset(),canvas.renderAll(),lineAdded=!0}}function onSelectedCleared(){$("#text-tool a").removeClass("active"),$("#border-line-width").slider("value",0)}function onObjectSelected(a){var b=a.target;b.hasRotatingPoint=!0,b&&"text"===b.type?($("#line-height").prev().val(10*b.lineHeight),$("#text-string").val(b.getText()),"bold"==b.fontWeight&&$("#text-bold").addClass("active"),"italic"==b.fontStyle&&$("#text-italic").addClass("active"),"line-through"==b.textDecoration&&$("#text-strike").addClass("active"),"underline"==b.textDecoration&&$("#text-underline").addClass("active"),"left"==b.textAlign?$("#text-align-left").addClass("active"):"center"==b.textAlign?$("#text-align-center").addClass("active"):"right"==b.textAlign&&$("#text-align-right").addClass("active"),b.originalState.fill&&$("#main-color").minicolors("value",b.originalState.fill),b.stroke&&($("#stroke-color").minicolors("value",b.stroke),$("#border-line-width").slider("value",b.strokeWidth))):b&&(b.fill&&"rgb(0,0,0)"!=b.fill?$("#main-color").minicolors("value",b.fill):$("#main-color").minicolors("value","#333333"),""!=b.stroke&&"rgb(0,0,0)"!=b.fill?($("#stroke-color").minicolors("value",b.stroke),$("#border-line-width").slider("value",b.strokeWidth)):$("#stroke-color").minicolors("value","#333333"))}function defaultArray(a,b,c,d){return c||d?{left:b,top:a,width:c,height:d}:{left:b,top:a}}function setFont(a){var b=canvas.getActiveObject();b&&"text"===b.type&&(b.fontFamily=a,b.setCoords(),canvas.calcOffset().renderAll())}function dropthat(a,b,c){var d=b,e=c;fabric.Image.fromURL(a,function(a){a.set(defaultArray(e,d)),a.setCoords(),canvas.add(a)})}function getCurrentColor(){return $("#main-color").minicolors()?$("#main-color").val():"#333333"}function addSvg(a){var b=[];try{fabric.loadSVGFromURL(a,function(a,c){{var d=fabric.util.groupSVGElements(a,c);new fabric.Group(b)}d.set(defaultArray(100,100)),canvas.add(d),canvas.renderAll()})}catch(c){}}function addImage(a){{var b=canvas.getWidth()/2;canvas.getHeight()}try{fabric.Image.fromURL(a,function(a){imageWidth=a.getWidth(),imageHeight=a.getHeight(),a.set({top:0,left:0,scaleX:b/imageWidth,scaleY:b/imageWidth}),canvas.add(a),a.center().setCoords(),canvas.renderAll()})}catch(c){}}function sendAjax(a,b,c,d,e,f){$.ajax({type:"POST",dataType:"json",url:fa_settings.site_url_+"/wp-admin/admin-ajax.php",data:{type:$("#tshirtFacing").data("id"),front_base:$("#tshirtFacing").data("front"),back_base:$("#tshirtFacing").data("back"),image_f:c,image_b:d,action:"create_the_product",jsonstufff:e,jsonstuffb:f},beforeSend:function(a){a&&a.overrideMimeType&&a.overrideMimeType("application/json;charset=UTF-8")},success:function(a){1==a.success&&(window.location=a.message)},error:function(){}})}function ajax_load(c){$.ajax({type:"POST",dataType:"json",url:fa_settings.site_url_+"/wp-admin/admin-ajax.php",data:{id:c,action:"custom_data_product"},beforeSend:function(a){a&&a.overrideMimeType&&a.overrideMimeType("application/json;charset=UTF-8")},success:function(c){1==c.success&&(canvas.loadFromJSON(c.json_a,function(){canvas.calcOffset().renderAll()}),a=c.json_a?c.json_a:"",b=c.json_b?c.json_b:"")},error:function(){}})}function dblClickHandler(){var a=canvas.getActiveObject(),b=canvas.getActiveGroup();if(a)a.sendToBack();else if(b){var c=b.getObjects();canvas.discardActiveGroup(),c.forEach(function(a){a.sendToBack()})}}function cache(){canvas.forEachObject(function(a,b){if("image"!==a.type){var c=a.scaleX,d=a.scaleY;canvas.remove(a),a.scale(1).cloneAsImage(function(e){e.set({left:a.left,top:a.top,scaleX:c,scaleY:d}),canvas.insertAt(e,b)})}})}!function(a){a.fn.visible=function(b){var c=a(this),d=a(window),e=d.scrollTop(),f=e+d.height(),g=c.offset().top,h=g+c.height(),i=b===!0?h:g,j=b===!0?g:h;return f>=j&&i>=e}}(jQuery),function(a){a.fn.fontselect=function(){var b=function(a,b){return function(){return a.apply(b,arguments)}};tmp_fonts=fa_settings.setting_font_list_.replace(/%2B/g,"+");var c=tmp_fonts.split(","),d={style:"font-select",placeholder:"Select a font",lookahead:1,pager:10,api:"https://fonts.googleapis.com/css?family="},e=function(){function d(b,c){this.$original=a(b),this.options=c,this.active=!1,this.setupHtml(),this.getVisibleFonts(),this.scrollEvent(),this.bindEvents();var d=this.$original.val();d&&(this.updateSelected(),this.addFontLink(d))}return d.prototype.bindEvents=function(){this.$results.on("click","li.font-family",b(this.selectFont,this)).on("mouseenter","li",b(this.activateFont,this)).on("mouseleave","li",b(this.deactivateFont,this)),this.$results.on("click","span",b(this.toggleDrop,this)),this.$select.on("click","span",b(this.toggleDrop,this))},d.prototype.toggleDrop=function(){this.active?(this.$element.removeClass("font-select-active"),this.$drop.removeClass("show"),clearInterval(this.visibleInterval)):(this.$element.addClass("font-select-active"),this.$drop.addClass("show"),this.moveToSelected(),this.visibleInterval=setInterval(b(this.getVisibleFonts,this),500)),this.active=!this.active},d.prototype.selectFont=function(){var b=a("li.active",this.$results).data("value");this.$original.val(b).change(),this.updateSelected(),this.toggleDrop()},d.prototype.moveToSelected=function(){var b,c=this.$original.val();b=c?a("li[data-value='"+c+"']",this.$results):a("li",this.$results).first()},d.prototype.activateFont=function(b){a("li.active",this.$results).removeClass("active"),a(b.currentTarget).addClass("active")},d.prototype.deactivateFont=function(b){a(b.currentTarget).removeClass("active")},d.prototype.updateSelected=function(){var b=this.$original.val();a("span",this.$element).text(this.toReadable(b)).css(this.toStyle(b))},d.prototype.setupHtml=function(){this.$original.empty(),this.$element=a("<div>",{"class":this.options.style}),this.$arrow=a(""),this.$select=a('<a class="fa-button"><span>'+this.options.placeholder+'</span><i class="icon icon-chevron-down"></i></a>'),this.$drop=a("<div>",{"class":"fs-drop dropdown-menu"}),this.$results=a("<ul>",{"class":"fs-results"}),this.$original.after(this.$element.append(this.$select.append(this.$arrow)).append(this.$drop)),this.$drop.append(this.$results.append(this.fontsAsHtml(0)))},d.prototype.scrollLoader=function(){var a=this.$drop.find("div:last-child");if(1==a.visible()){var b=a.data("point");this.$drop.append(this.$results.append(this.fontsAsHtml(b+1)))}},d.prototype.scrollEvent=function(){this.$drop.scroll(b(this.scrollLoader,this))},d.prototype.fontsAsHtml=function(a){for(var b,d,e=this.options.pager,f="",g=a;e+a>=g;g++)a+e-1>=c.length||(b=this.toReadable(c[g]),d=this.toStyle(c[g]),f+='<li class="font-family" data-value="'+c[g]+'" style="font-family: '+d["font-family"]+';">'+b+"</li>",g==a+e&&(f+='<div data-point="'+(a+e)+'"></div>'));return f},d.prototype.toReadable=function(a){return a?a.replace(/[\+|:]/g," "):void 0},d.prototype.toStyle=function(a){var b=a.split(":");return{"font-family":this.toReadable(b[0]),"font-weight":b[1]||400}},d.prototype.getVisibleFonts=function(){if(!this.$results.is(":hidden")){var b=this,c=this.$results.scrollTop(),d=c+this.$results.height();if(this.options.lookahead){var e=a("li",this.$results).first().height();d+=e*this.options.lookahead}a("li",this.$results).each(function(){var e=a(this).position().top+c,f=e+a(this).height();if(f>=c&&d>=e){var g=a(this).data("value");b.addFontLink(g)}})}},d.prototype.addFontLink=function(b){var c=this.options.api+b;0===a("link[href*='"+b+"']").length&&a("link:last").after('<link href="'+c+'" rel="stylesheet" type="text/css">')},d}();return this.each(function(b){return b&&a.extend(d,b),new e(this,d)})}}(jQuery);var canvas,tshirts=new Array,a,b,line,$color,imgf,imgb,front,back,grid=10,hasback=1,lineAdded=!1,lineW,lineH,copiedObject,copiedObjects=new Array,canvasScale=1,SCALE_FACTOR=1.2,drawline,line,isDown;$(document).ready(function(){{var c=$("#tshirtFacing").data("front"),d=$("#tshirtFacing").data("back");$(".progress-bar")}canvas=new fabric.Canvas("tcanvas"),canvas.on({"object:selected":onObjectSelected,"selection:cleared":onSelectedCleared,"object:moving":onObjectMoving,"mouse:up":onMouseUp,"mouse:move":moveLine,"mouse:down":startLine}),console.log(fa_settings.edit_id),fa_settings.edit_id&&ajax_load(fa_settings.edit_id),""==d&&(hasback=0,$("#flip").remove()),$(".handle").on("click",function(){"0"==$(this).data("close")?($(".tool-container").addClass("closeme"),$(".widget div").removeClass("visible"),$(this).data("close","1")):($(".tool-container").removeClass("closeme"),$(this).data("close","0"))}),$(".widget > h3").on("click",function(){$(this).next().hasClass("visible")?$(this).next().removeClass("visible"):$(this).data("save")||($(".tool-container").removeClass("closeme"),$(".widget > div").removeClass("visible"),$(this).next().addClass("visible"))}),jQuery("body").on("click",".media-navigation li",function(a){a.preventDefault(),jQuery.ajax({type:"POST",dataType:"json",async:!0,url:fa_settings.site_url_+"/wp-admin/admin-ajax.php",data:{category:$(".get-last-category:last").data("cat"),page:$(this).children().data("next"),posts_per_page:$(".get-last-category").data("perpage"),action:"paginate_media_gallery"},beforeSend:function(){$(".photo.gallery-item > .progress-bar").addClass("active")},success:function(a){if(""!=a.out){var b=$(".media-navigation li > a").data("next");$(".gallery-item .photo-list").append(a.out),$(".media-navigation li > a").data("next",b+1),$(".photo.gallery-item > .progress-bar").removeClass("active")}else $(".media-navigation .next a").html("Nothing to show")}})}),$(".goback").on("click",function(){$("#accorde > h3").removeClass("bye"),$(this).parent().removeClass("visible")}),$("img").on("dragstart",function(a){a.preventDefault()}),$("#orderit-ajax").click(function(e){e.preventDefault(),current=JSON.stringify(canvas),obj=JSON.parse(current),a||b||0!=obj.objects.length?(showProgressBar(),flip(c,d,canvas,!0),a&&b&&0!=hasback?(canvas.deactivateAll().renderAll(),front=JSON.stringify(a),back=JSON.stringify(b),$color=canvas.backgroundColor,canvas.loadFromJSON(a,function(){$("#shirtDiv").data("holdera",canvas.toDataURL("jpg")),canvas.loadFromJSON(b,function(){canvas.deactivateAll().renderAll(),$("#shirtDiv").data("holderb",canvas.toDataURL("jpg")),setTimeout(sendAjax($color,type="",$("#shirtDiv").data("holdera"),$("#shirtDiv").data("holderb"),front,back),200)})})):($color=canvas.backgroundColor,a?(front=JSON.stringify(a),back="",canvas.loadFromJSON(a,function(){canvas.deactivateAll().renderAll(),$("#shirtDiv").data("holder",canvas.toDataURL("jpg")),sendAjax($color,type="",$("#shirtDiv").data("holder"),"",front,back)})):b&&(back=JSON.stringify(b),front="",canvas.loadFromJSON(b,function(){canvas.deactivateAll().renderAll(),$("#shirtDiv").data("holder",canvas.toDataURL("jpg")),sendAjax($color,type="","",$("#shirtDiv").data("holder"),front,back)})))):$(this).html("Nothing There").delay(400).html("Create Product")}),$("#font-family").fontselect().change(function(){var a=$(this).val().replace(/\+/g," ");setFont(a)}),$("nav > div > .dropdown > span").on("click",function(){$(this).toggleClass("open"),console.log("s"),$("ul.sub-menu").removeClass("visible"),$(this).hasClass("open")?$(this).next("ul.sub-menu").addClass("visible"):$(this).next("ul.sub-menu").removeClass("visible")}),$(document).mouseup(function(a){var b=$("ul.sub-menu");b.is(a.target)||0!==b.has(a.target).length||(b.removeClass("visible"),b.prev().removeClass("open"))}),$("#main-color").minicolors({inline:!0,change:function(){var a=canvas.getActiveObject();$("span.color-main").css("background-color",this.value),a&&"path"!==a.type?a.fill=this.value:a&&(a.stroke=this.value),canvas.isDrawingMode&&(canvas.freeDrawingBrush.color=this.value),canvas.renderAll()}}),$("span.color-main").css("background-color",$("#main-color").minicolors("value")),$("span.color-secondary").css("background-color",$("#stroke-color").minicolors("value")),$("#stroke-color").minicolors({inline:!0,change:function(){$("span.color-secondary").css("background-color",this.value);var a=canvas.getActiveObject();a&&(a.stroke=this.value,canvas.renderAll())}}),$(".slider").slider({min:0,max:50,change:function(){{var a=$(this).slider("value"),b=$(this).data("type");$(this).data("eval")}if("draw"==b&&(linewidth=a,canvas.freeDrawingBrush.width=parseInt(linewidth,10)||1),canvas.getActiveObject()){var c=canvas.getActiveObject();"border"==b&&(c.stroke=$("#stroke-color").minicolors("value"),"text"===c.type&&(a/=2),0==a?(c.stroke=null,c.strokeWidth=""):c.strokeWidth=a,c.setCoords(),canvas.renderAll())}}}),initCustomization();var e=$(".freedraw");canvas.freeDrawingCursor="crosshair",$("#paint-tools .rect").on("click",function(){clearOther();var a=canvas.height/2-100,b=canvas.width/2-50,c=new fabric.Rect(defaultArray(a,b,100,100));c.fill=getCurrentColor(),canvas.add(c),canvas.renderAll()}),$("#paint-tools .triangle").on("click",function(){clearOther();var a=canvas.height/2-100,b=canvas.width/2-50,c=new fabric.Triangle(defaultArray(a,b,100,100));c.fill=getCurrentColor(),canvas.add(c),canvas.renderAll()}),$("#paint-tools .poly a").on("click",function(){clearOther();for(var a=canvas.height/2-100,b=canvas.width/2-50,c=new Array,d=parseInt($(this).prev("input").val())>3&&parseInt($(this).prev("input").val())?parseInt($(this).prev("input").val()):"5",e=25,f=25,g=100,h=1;d>=h;h+=1)c.push({x:e+g*Math.cos(2*h*Math.PI/d),y:f+g*Math.sin(2*h*Math.PI/d)});var i=new fabric.Polygon(c,defaultArray(a,b));i.fill=getCurrentColor(),canvas.add(i),canvas.renderAll()}),$("#paint-tools .line").on("click",function(){"true"==drawline||$(this).hasClass("active")?($(this).removeClass("active"),$(".line-draw").hide(),drawline=!1):(0==drawline||void 0==drawline)&&($(this).addClass("active"),$(".line-draw").show(),drawline=!0)}),$("#paint-tools .circle").on("click",function(){clearOther();var a=canvas.width/2-100,b=canvas.height/2-100,c=new fabric.Circle({left:a,top:b,radius:50});c.fill=getCurrentColor(),canvas.add(c),canvas.renderAll()}),e.on("click",function(){canvas.isDrawingMode=!canvas.isDrawingMode,canvas.freeDrawingBrush.color=getCurrentColor(),canvas.freeDrawingBrush.width=parseInt($("#drawing-line-width").slider("option","value")),canvas.isDrawingMode?($(this).addClass("active"),$(".line-draw").show()):($(this).removeClass("active"),$(".line-draw").hide())}),fabric.util.addListener(fabric.document,"dblclick",dblClickHandler),fabric.util.removeListener(canvas.upperCanvasEl,"dblclick",dblClickHandler),$("#add-text").on("click",function(){if(""==$("#text-string").val())$(this).attr("data-tooltip","Nothing to Add");else{$(this).removeData("data-tooltip");var a=$("#text-string").val(),b=canvas.width/2,c=canvas.height/2,d=new fabric.Text(a,{left:b,top:c,angle:0});d.fontFamily=$("#font-family").val().replace(/\+/g," ")?$("#font-family").val().replace(/\+/g," "):"arial",d.fill=getCurrentColor(),canvas.add(d),d.center().setCoords(),canvas.renderAll()}}),$("#text-string").keyup(function(){$("#add-text").removeData("data-tooltip");var a=canvas.getActiveObject();a&&"text"===a.type&&(a.text=this.value,canvas.renderAll().setCoords())}),$(".photo").on("click","img",function(){var a=$(this).data("full"),b=a.split(".").pop();"svg"==b?addSvg(a):addImage(a)}),$("#remove-selected").click(function(){var a=canvas.getActiveObject(),b=canvas.getActiveGroup();if(a)canvas.remove(a),$("#text-string").val("");else if(b){var c=b.getObjects();canvas.discardActiveGroup(),c.forEach(function(a){canvas.remove(a)})}}),$("#bring-to-front").click(function(){var a=canvas.getActiveObject(),b=canvas.getActiveGroup();if(a)a.bringToFront();else if(b){var c=b.getObjects();canvas.discardActiveGroup(),c.forEach(function(a){a.bringToFront()})}}),$("#send-to-back").click(function(){var a=canvas.getActiveObject(),b=canvas.getActiveGroup();if(a)a.sendToBack();else if(b){var c=b.getObjects();canvas.discardActiveGroup(),c.forEach(function(a){a.sendToBack()})}}),$("#line-height").click(function(){var a=Math.abs(parseInt($(this).prev("input").val()))?Math.abs(parseInt($(this).prev("input").val())):"2",b=canvas.getActiveObject();b&&"text"===b.type&&(b.lineHeight=a/10,b.setCoords(),canvas.calcOffset().renderAll())}),$("#text-bold").click(function(){var a=canvas.getActiveObject();a&&"text"===a.type&&($(this).toggleClass("active"),a.fontWeight="bold"==a.fontWeight?"":"bold",canvas.calcOffset().renderAll())}),$("#text-italic").click(function(){var a=canvas.getActiveObject();a&&"text"===a.type&&($(this).toggleClass("active"),a.fontStyle="italic"==a.fontStyle?"":"italic",canvas.calcOffset().renderAll())}),$("#text-strike").click(function(){var a=canvas.getActiveObject();a&&"text"===a.type&&($(this).toggleClass("active"),a.textDecoration="line-through"==a.textDecoration?"":"line-through",canvas.calcOffset().renderAll())}),$("#text-underline").click(function(){var a=canvas.getActiveObject();a&&"text"===a.type&&($(this).toggleClass("active"),a.textDecoration="underline"==a.textDecoration?"":"underline",canvas.calcOffset().renderAll())}),$("#text-align-left").click(function(){var a=canvas.getActiveObject();a&&"text"===a.type&&($(this).toggleClass("active"),a.textAlign="left",canvas.calcOffset().renderAll())}),$("#text-align-center").click(function(){var a=canvas.getActiveObject();a&&"text"===a.type&&($(this).toggleClass("active"),a.textAlign="center",canvas.calcOffset().renderAll())}),$("#text-align-right").click(function(){var a=canvas.getActiveObject();a&&"text"===a.type&&($(this).toggleClass("active"),a.textAlign="right",canvas.calcOffset().renderAll())}),$("#font-family").change(function(){var a=canvas.getActiveObject();a&&"text"===a.type&&(a.fontFamily=$(this).val().replace(/\+/g," ")?$(this).val().replace(/\+/g," "):"Arial",canvas.calcOffset(),canvas.renderAll())}),$("#upload-input").on("change",function(a){handleFiles(a)}),$("#backgrounds a").on("click",function(a){a.preventDefault(),$("#backgrounds a").removeClass("selected"),$(this).toggleClass("selected");var b=$(this).data("front"),c=$(this).data("back"),d=($(this).data("id"),$(".flipper > img").css("width")),e=$(".flipper > img").css("height"),f='<img style="height:'+e+"!important;width:"+d+'!important;" src="'+b+'"/><img style="height:'+e+"!important;width:"+d+'!important;" src="'+c+'"/>',g='<img src="'+b+'"/>';$("#backgrounds").css("background-color",$(this).css("background-color")),$("#tshirtFacing").data("front",b),$("#tshirtFacing").data("back",c),$("#backgrounds > span").html(g),$(".flipper").html(f)});for(var f=document.querySelectorAll(".photo img"),g=null,h=0;h<f.length;h++)g=f[h],g.setAttribute("draggable","true"),addEvent(g,"dragstart",function(a){a.dataTransfer.effectAllowed="copy",a.dataTransfer.setData("Text",this.src)});var i=document.querySelector(".canvas-container");addEvent(i,"dragover",function(a){return a.preventDefault&&a.preventDefault(),this.className="over",a.dataTransfer.dropEffect="copy",!1}),addEvent(i,"dragenter",function(){return this.className="",!1}),addEvent(i,"dragleave",function(){this.className=""}),addEvent(i,"drop",function(a){if(a.stopPropagation&&a.stopPropagation(),this.className="",a.stopPropagation(),a.preventDefault(),a.dataTransfer.files[0])handleFiles(a.dataTransfer.files[0],!0);else{var b=a.dataTransfer.getData("Text");dropthat(b,a.clientX-140,a.clientY-140)}return!1}),$("#flip").on("click",function(){$(this).toggleClass("hover"),flip(c,d,canvas,!1)})});var getObjectById=function(a){var b=canvas.getObjects();for(obj in b)if(b[obj].get("id")==a)return b[obj]},addEvent=function(){return document.addEventListener?function(a,b,c){if(a&&a.nodeName||a===window)a.addEventListener(b,c,!1);else if(a&&a.length)for(var d=0;d<a.length;d++)addEvent(a[d],b,c)}:function(a,b,c){if(a&&a.nodeName||a===window)a.attachEvent("on"+b,function(){return c.call(a,window.event)});else if(a&&a.length)for(var d=0;d<a.length;d++)addEvent(a[d],b,c)}}();